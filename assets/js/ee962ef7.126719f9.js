"use strict";(self.webpackChunkdf_docs=self.webpackChunkdf_docs||[]).push([[190],{9105:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var s=n(4848),t=n(8453);const i={sidebar_position:3},a="Interacting with the API",o={id:"API Creation and Management/interacting-with-api",title:"Interacting with the API",description:"The following topic contains examples to help you become familiar with the many ways you can interact with a database-backed API. For these examples we're using the Insomnia HTTP client, however you can use any similar client or even cURL to achieve the same results.",source:"@site/docs/API Creation and Management/interacting-with-api.md",sourceDirName:"API Creation and Management",slug:"/API Creation and Management/interacting-with-api",permalink:"/API Creation and Management/interacting-with-api",draft:!1,unlisted:!1,editUrl:"https://github.com/dreamfactorysoftware/df-docs/tree/main/docs/API Creation and Management/interacting-with-api.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"intro",previous:{title:"Generating a Database-backed API",permalink:"/API Creation and Management/generating-a-database-backed-api"},next:{title:"Role Based Access",permalink:"/Security and Authentication/role-based-access"}},d={},l=[{value:"Retrieving all records",id:"retrieving-all-records",level:3},{value:"Limiting results",id:"limiting-results",level:3},{value:"Offsetting results",id:"offsetting-results",level:3},{value:"Ordering results",id:"ordering-results",level:3},{value:"Selecting specific fields",id:"selecting-specific-fields",level:3},{value:"Filtering records by condition",id:"filtering-records-by-condition",level:3},{value:"Combining parameters",id:"combining-parameters",level:3},{value:"Querying by primary key",id:"querying-by-primary-key",level:3},{value:"Joining tables",id:"joining-tables",level:3},{value:"Inserting records",id:"inserting-records",level:3},{value:"Adding records to multiple tables",id:"adding-records-to-multiple-tables",level:4},{value:"Updating records",id:"updating-records",level:3},{value:"Updating records with PUT",id:"updating-records-with-put",level:4},{value:"Updating records with PATCH",id:"updating-records-with-patch",level:4},{value:"Deleting records",id:"deleting-records",level:3},{value:"Working with stored procedures",id:"working-with-stored-procedures",level:2},{value:"Listing available stored procedures",id:"listing-available-stored-procedures",level:3},{value:"Getting stored procedure details",id:"getting-stored-procedure-details",level:3},{value:"Calling a stored procedure",id:"calling-a-stored-procedure",level:3},{value:"Using GET",id:"using-get",level:4},{value:"Using POST",id:"using-post",level:4},{value:"Formatting results",id:"formatting-results",level:3},{value:"Using symmetric keys to decrypt data in a stored procedure (SQL Server)",id:"using-symmetric-keys-to-decrypt-data-in-a-stored-procedure-sql-server",level:3}];function c(e){const r={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"interacting-with-the-api",children:"Interacting with the API"})}),"\n",(0,s.jsx)(r.p,{children:"The following topic contains examples to help you become familiar with the many ways you can interact with a database-backed API. For these examples we're using the Insomnia HTTP client, however you can use any similar client or even cURL to achieve the same results."}),"\n",(0,s.jsx)(r.h3,{id:"retrieving-all-records",children:"Retrieving all records"}),"\n",(0,s.jsxs)(r.p,{children:["Let's begin by retrieving all of a particular table's records just as was done within the API Docs example. Open your client and in the address bar set the URL to ",(0,s.jsx)(r.code,{children:"/api/v2/{service_name}/{table_name}"}),", replacing ",(0,s.jsx)(r.code,{children:"{service_name}"})," with the name of your API and ",(0,s.jsx)(r.code,{children:"{table_name}"})," with the name of a table found within the database (and to which your API key's associated role has access). For the remainder of this example we use ",(0,s.jsx)(r.code,{children:"mysql"})," as the service name, and in this particular example the table we're querying is called ",(0,s.jsx)(r.code,{children:"employees"})," so the URL looks like this:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"http://localhost/api/v2/_table/employees\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Also, because we're retrieving records the method is set to ",(0,s.jsx)(r.code,{children:"GET"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Next, you must set the header which defines the API key. This header should be named ",(0,s.jsx)(r.code,{children:"X-DreamFactory-Api-Key"}),". You might have to hunt around for a moment within your HTTP client to figure out where this is placed, but we promise it is definitely there. In the case of Insomnia select the ",(0,s.jsx)(r.strong,{children:"Header"})," tab found directly below the address bar:"]}),"\n",(0,s.jsx)("img",{src:"/img/database-backed-api/insomnia-api-key.png",width:"800",alt:"Setting DreamFactory API Key Header"}),"\n",(0,s.jsx)(r.p,{children:"With the URL and header in place, request the URL and you should see the table records returned in JSON format:"}),"\n",(0,s.jsx)("img",{src:"/img/database-backed-api/insomnia-all-records.png",width:"400",alt:"JSON response of GET Request for All Records"}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query would look like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT * FROM employees;\n"})}),"\n",(0,s.jsx)(r.h3,{id:"limiting-results",children:"Limiting results"}),"\n",(0,s.jsxs)(r.p,{children:["The previous example returns all records found in the ",(0,s.jsx)(r.code,{children:"employees"})," table. But what if you only wanted to return five or ten records? You can use the ",(0,s.jsx)(r.code,{children:"limit"})," parameter to do so. Modify your URL to look like this:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"http://localhost/api/v2/_table/employees?limit=10\n"})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query would look like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT * FROM employees LIMIT 10;\n"})}),"\n",(0,s.jsx)(r.h3,{id:"offsetting-results",children:"Offsetting results"}),"\n",(0,s.jsxs)(r.p,{children:["The above example limits your results found in the ",(0,s.jsx)(r.code,{children:"employees"})," table to 10, but what if you want to select records 11 - 20? You would use the ",(0,s.jsx)(r.code,{children:"offset"})," parameter like this:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"http://localhost/api/v2/_table/employees?limit=10&offset=10\n"})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query would look like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT * FROM employees LIMIT 10 OFFSET 10;\n"})}),"\n",(0,s.jsx)(r.h3,{id:"ordering-results",children:"Ordering results"}),"\n",(0,s.jsxs)(r.p,{children:["You can order results by any column using the ",(0,s.jsx)(r.code,{children:"order"})," parameter. For instance to order the ",(0,s.jsx)(r.code,{children:"employees"})," tab by the ",(0,s.jsx)(r.code,{children:"emp_no"})," field, modify your URL to look like this:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"http://localhost/api/v2/_table/employees?order=emp_no\n"})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query looks like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT * FROM employees ORDER BY emp_no;\n"})}),"\n",(0,s.jsxs)(r.p,{children:["To order in descending fashion, just append ",(0,s.jsx)(r.code,{children:"desc"})," to the ",(0,s.jsx)(r.code,{children:"order"})," string:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"http://localhost/api/v2/_table/employees?order=emp_no%20desc\n"})}),"\n",(0,s.jsx)(r.admonition,{title:"Note",type:"note",children:(0,s.jsxs)(r.p,{children:["The space separating ",(0,s.jsx)(r.code,{children:"emp_no"})," and ",(0,s.jsx)(r.code,{children:"desc"})," has been HTML encoded. Most programming languages offer HTML encoding capabilities either natively or through a third-party library so there's no need for you to do this manually within your applications. The equivalent SQL query looks like this:"]})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT * FROM employees ORDER BY emp_no DESC;\n"})}),"\n",(0,s.jsx)(r.h3,{id:"selecting-specific-fields",children:"Selecting specific fields"}),"\n",(0,s.jsxs)(r.p,{children:["Often you only require a few of the fields found in a table. To limit the fields returned, use the ",(0,s.jsx)(r.code,{children:"fields"})," parameter:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"http://localhost/api/v2/_table/employees?fields=emp_no%2Clast_name\n"})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query looks like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT emp_no, last_name FROM employees;\n"})}),"\n",(0,s.jsx)(r.h3,{id:"filtering-records-by-condition",children:"Filtering records by condition"}),"\n",(0,s.jsxs)(r.p,{children:["You can filter records by a particular condition using the ",(0,s.jsx)(r.code,{children:"filter"})," parameter. For instance to return only those records having a ",(0,s.jsx)(r.code,{children:"gender"})," equal to ",(0,s.jsx)(r.code,{children:"M"}),", set the ",(0,s.jsx)(r.code,{children:"filter"})," parameter like so:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"http://localhost/api/v2/_table/employees?filter=(gender=M)\n"})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query looks like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT * FROM employees where gender='M';\n"})}),"\n",(0,s.jsxs)(r.p,{children:["You're free to use any of the typical comparison operators, such as ",(0,s.jsx)(r.code,{children:"LIKE"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"http://localhost/api/v2/_table/employees?filter=(last_name%20like%20G%25)\n"})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query looks like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT * FROM employees where last_name LIKE 'G%';\n"})}),"\n",(0,s.jsx)(r.h3,{id:"combining-parameters",children:"Combining parameters"}),"\n",(0,s.jsxs)(r.p,{children:["The REST API's capabilities really begin to shine when combining multiple parameters together. For example, let's query the ",(0,s.jsx)(r.code,{children:"employees"})," table to retrieve only those records having a ",(0,s.jsx)(r.code,{children:"last_name"})," beginning with ",(0,s.jsx)(r.code,{children:"G"}),", ordering the results by ",(0,s.jsx)(r.code,{children:"emp_no"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"http://localhost/api/v2/_table/employees?filter=(last_name%20like%20G%25)&order=emp_no\n"})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query looks like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT * FROM employees where last_name LIKE 'G%' ORDER BY emp_no;\n"})}),"\n",(0,s.jsx)(r.h3,{id:"querying-by-primary-key",children:"Querying by primary key"}),"\n",(0,s.jsxs)(r.p,{children:["You may want to select a specific record using a column that uniquely defines it. Often (but not always) this unique value is the ",(0,s.jsx)(r.em,{children:"primary key"}),". You can retrieve a record using its primary key by appending the value to the URL like so:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/_table/supplies/45\n"})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query looks like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT * FROM supplies where id = 5;\n"})}),"\n",(0,s.jsxs)(r.p,{children:["If you'd like to use this URL format to search for another unique value not defined as a primary key, you must also pass along the ",(0,s.jsx)(r.code,{children:"id_field"})," and ",(0,s.jsx)(r.code,{children:"id_type"})," fields like so:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/_table/employees/45abchdkd?id_field=guid&id_type=string\n"})}),"\n",(0,s.jsx)(r.h3,{id:"joining-tables",children:"Joining tables"}),"\n",(0,s.jsxs)(r.p,{children:["One of DreamFactory's most interesting database-related features is the automatic support for table joins. When DreamFactory creates a database-backed API, it parses all of the database tables, learning everything it can about the tables, including the column names, attributes, and relationships. The relationships are assigned aliases, and presented for referential purposes within DreamFactory's ",(0,s.jsx)(r.code,{children:"Schema"})," tab. For instance, the following screenshot contains the list of relationship aliases associated with the ",(0,s.jsx)(r.code,{children:"employees"})," table:"]}),"\n",(0,s.jsx)("img",{src:"/img/database-backed-api/mysql-relationships.png",width:"800",alt:"Joining Tables with DreamFactory"}),"\n",(0,s.jsxs)(r.p,{children:["Using these aliases along with the ",(0,s.jsx)(r.code,{children:"related"})," parameter we can easily return sets of joined records via the API. For instance, the following URI would be used to join the ",(0,s.jsx)(r.code,{children:"employees"})," and ",(0,s.jsx)(r.code,{children:"departments"})," tables together:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/mysql/_table/employees?related=dept_emp_by_emp_no\n"})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query looks like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SELECT * FROM employees\r\n    LEFT JOIN departments on employees.emp_no = departments.emp_no;\n"})}),"\n",(0,s.jsx)(r.p,{children:"The joined results are presented within a JSON array having a name matching that of the alias:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'    {\r\n        "emp_no": 10001,\r\n        "birth_date": "1953-09-02",\r\n        "first_name": "Georgi",\r\n        "last_name": "Facello",\r\n        "gender": "M",\r\n        "hire_date": "1986-06-26",\r\n        "birth_year": "1953",\r\n        "dept_emp_by_emp_no": [\r\n            {\r\n                "emp_no": 10001,\r\n                "dept_no": "d005",\r\n                "from_date": "1986-06-26",\r\n                "to_date": "9999-01-01"\r\n            }\r\n        ]\r\n    }\n'})}),"\n",(0,s.jsx)(r.h3,{id:"inserting-records",children:"Inserting records"}),"\n",(0,s.jsxs)(r.p,{children:["To insert a record, send a ",(0,s.jsx)(r.code,{children:"POST"})," request to the API, passing along a JSON-formatted payload. For instance, to add a new record to the ",(0,s.jsx)(r.code,{children:"supplies"})," table, send a ",(0,s.jsx)(r.code,{children:"POST"})," request to the following URI:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/mysql/_table/supplies\n"})}),"\n",(0,s.jsx)(r.p,{children:"The body payload would look like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'    {\r\n        "resource": [\r\n            {\r\n                "name": "Stapler"\r\n            }\r\n        ]\r\n    }\n'})}),"\n",(0,s.jsxs)(r.p,{children:["If the request is successful, DreamFactory returns a ",(0,s.jsx)(r.code,{children:"200"})," status code and a response containing the record's primary key:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'    {\r\n        "resource": [\r\n          {\r\n            "id": 9\r\n          }\r\n        ]\r\n    }\n'})}),"\n",(0,s.jsx)(r.h4,{id:"adding-records-to-multiple-tables",children:"Adding records to multiple tables"}),"\n",(0,s.jsxs)(r.p,{children:["If you want to create a new record and associate it with another table, you can use a single HTTP request. Consider the following two tables. The first, ",(0,s.jsx)(r.code,{children:"supplies"}),", manages a list of company supplies (staplers, brooms, etc). The company requires that all supply are closely tracked in the corporate database, and so another table, ",(0,s.jsx)(r.code,{children:"locations"}),", exists for this purpose. Each record in the ",(0,s.jsx)(r.code,{children:"locations"})," table includes a location name and foreign key reference to a record found in the ",(0,s.jsx)(r.code,{children:"supplies"})," table."]}),"\n",(0,s.jsx)(r.admonition,{title:"Note",type:"note",children:(0,s.jsx)(r.p,{children:"In the real world the location names would likely be managed in a separate table and then a join table would relate locations and supplies together. We're just trying to keep things simple for the purposes of this demonstration."})}),"\n",(0,s.jsx)(r.p,{children:"The table schemas look like this:"}),"\n",(0,s.jsxs)(r.p,{children:["CREATE TABLE ",(0,s.jsx)(r.code,{children:"supplies"})," (\r\n",(0,s.jsx)(r.code,{children:"id"})," int(11) unsigned NOT NULL AUTO_INCREMENT,\r\n",(0,s.jsx)(r.code,{children:"name"})," varchar(255) DEFAULT NULL,\r\nPRIMARY KEY (",(0,s.jsx)(r.code,{children:"id"}),")\r\n) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;"]}),"\n",(0,s.jsxs)(r.p,{children:["CREATE TABLE ",(0,s.jsx)(r.code,{children:"locations"})," (\r\n",(0,s.jsx)(r.code,{children:"id"})," int(11) unsigned NOT NULL AUTO_INCREMENT,\r\n",(0,s.jsx)(r.code,{children:"supply_id"})," int(10) unsigned NOT NULL,\r\n",(0,s.jsx)(r.code,{children:"name"})," varchar(255) DEFAULT NULL,\r\nPRIMARY KEY (",(0,s.jsx)(r.code,{children:"id"}),"),\r\nKEY ",(0,s.jsx)(r.code,{children:"supply_id"})," (",(0,s.jsx)(r.code,{children:"supply_id"}),"),\r\nCONSTRAINT ",(0,s.jsx)(r.code,{children:"locations_ibfk_1"})," FOREIGN KEY (",(0,s.jsx)(r.code,{children:"supply_id"}),") REFERENCES ",(0,s.jsx)(r.code,{children:"supplies"})," (",(0,s.jsx)(r.code,{children:"id"}),")\r\n) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;"]}),"\n",(0,s.jsxs)(r.p,{children:["Remember from the last example that DreamFactory creates convenient join aliases which can be used in conjunction with the ",(0,s.jsx)(r.code,{children:"related"})," parameter. In this case, that alias is ",(0,s.jsx)(r.code,{children:"locations_by_supply_id"}),". To create the relationship alongside the new ",(0,s.jsx)(r.code,{children:"supplies"})," record, use that alias to nest the location name within the payload, as demonstrated here:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'    {\r\n        "resource": [\r\n            {\r\n                "name": "Broom",\r\n                "locations_by_supply_id": [\r\n                    {\r\n                        "name": "Broom Closet"\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    }\n'})}),"\n",(0,s.jsxs)(r.p,{children:["With the payload sorted out, all that remains is to make a request to the ",(0,s.jsx)(r.code,{children:"supplies"})," table endpoint:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/mysql/_table/supplies\n"})}),"\n",(0,s.jsxs)(r.p,{children:["If the nested insert is successful, a ",(0,s.jsx)(r.code,{children:"200"})," status code is returned along with the primary key ID of the newly inserted ",(0,s.jsx)(r.code,{children:"supplies"})," record:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'    {\r\n        "resource": [\r\n            {\r\n                "id": 15\r\n            }\r\n        ]\r\n    }\n'})}),"\n",(0,s.jsx)(r.h3,{id:"updating-records",children:"Updating records"}),"\n",(0,s.jsx)(r.p,{children:"Updating database records is a straightforward matter in DreamFactory. However to do so you first need to determine which type of REST update you wany to perform. Two options are supported:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"PUT"}),": The ",(0,s.jsx)(r.code,{children:"PUT"})," request replaces an existing resource in its entirety. This means you need to pass along ",(0,s.jsx)(r.em,{children:"all"})," of the resource attributes regardless of whether the attribute value is actually being modified."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"PATCH"}),": The ",(0,s.jsx)(r.code,{children:"PATCH"})," request updates only part of the existing resource, meaning you only need to supply the resource primary key and the attributes you'd like to update. This is typically a much more convenient update approach than ",(0,s.jsx)(r.code,{children:"PUT"}),", although both have their uses."]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Let's work through update examples involving each method."}),"\n",(0,s.jsx)(r.h4,{id:"updating-records-with-put",children:"Updating records with PUT"}),"\n",(0,s.jsxs)(r.p,{children:["When updating records with ",(0,s.jsx)(r.code,{children:"PUT"})," you must send along ",(0,s.jsx)(r.em,{children:"all"})," of the record attributes within the request payload:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'    {\r\n        "resource": [\r\n            {\r\n                "emp_no": 500015,\r\n                "birth_date": "1900-12-15",\r\n                "first_name": "Johnny",\r\n                "last_name": "Football",\r\n                "gender": "m",\r\n                "hire_date": "2007-01-01"\r\n            }\r\n        ]\r\n    }\n'})}),"\n",(0,s.jsxs)(r.p,{children:["With the payload in place, send a ",(0,s.jsx)(r.code,{children:"PUT"})," request to the ",(0,s.jsx)(r.code,{children:"employees"})," table endpoint:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/mysql/_table/employees\n"})}),"\n",(0,s.jsxs)(r.p,{children:["If successful, DreamFactory returns a ",(0,s.jsx)(r.code,{children:"200"})," status code and a response body containing the primary key of the updated record:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'    {\r\n        "resource": [\r\n            {\r\n                "emp_no": 500015\r\n            }\r\n        ]\r\n    }\n'})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query looks like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"    UPDATE supplies SET first_name = 'Johnny', last_name = 'Football',\r\n    birthdate = '1900-12-15', gender = 'm', hire_date = '2007-01-01' WHERE emp_no = 500015;\n"})}),"\n",(0,s.jsx)(r.h4,{id:"updating-records-with-patch",children:"Updating records with PATCH"}),"\n",(0,s.jsxs)(r.p,{children:["To update one or more (but not all) attributes associated with a particular record found in the ",(0,s.jsx)(r.code,{children:"supplies"})," table, send a ",(0,s.jsx)(r.code,{children:"PATCH"})," request to the ",(0,s.jsx)(r.code,{children:"supplies"})," table endpoint, accompanied by the primary key:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/mysql/_table/supplies/8\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Suppose the ",(0,s.jsx)(r.code,{children:"supplies"})," table includes attributes such as ",(0,s.jsx)(r.code,{children:"name"}),", ",(0,s.jsx)(r.code,{children:"description"}),", and ",(0,s.jsx)(r.code,{children:"purchase_date"}),", but we only want to modify the ",(0,s.jsx)(r.code,{children:"name"})," value. The JSON request body would look like this:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'    {\r\n      "name": "Silver Stapler"\r\n    }\n'})}),"\n",(0,s.jsxs)(r.p,{children:["If successful, DreamFactory returns a ",(0,s.jsx)(r.code,{children:"200"})," status code and a response body containing the primary key of the updated record:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'    {\r\n      "id": 8\r\n    }\n'})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query looks like this:"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.code,{children:"UPDATE supplies SET name = 'Silver Stapler' WHERE id = 8;"})}),"\n",(0,s.jsx)(r.h3,{id:"deleting-records",children:"Deleting records"}),"\n",(0,s.jsxs)(r.p,{children:["To delete a record, send a ",(0,s.jsx)(r.code,{children:"DELETE"})," request to the table endpoint associated with the record you'd like to delete. For instance, to delete a record from the ",(0,s.jsx)(r.code,{children:"employees"})," table, reference this URL:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/mysql/_table/employees/500016\n"})}),"\n",(0,s.jsx)(r.p,{children:"If deletion is successful, DreamFactory returns a 200 status code with a response body containing the deleted record's primary key:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'    {\r\n        "resource": [\r\n            {\r\n                "emp_no": 500016\r\n            }\r\n        ]\r\n    }\n'})}),"\n",(0,s.jsx)(r.p,{children:"The equivalent SQL query looks like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"DELETE FROM employees WHERE emp_no = 500016;\n"})}),"\n",(0,s.jsx)(r.h2,{id:"working-with-stored-procedures",children:"Working with stored procedures"}),"\n",(0,s.jsxs)(r.p,{children:["Stored procedure support via the REST API is just for discovery and calling what you have already created on your database, it is not for managing the stored procedures themselves. They can be accessed on each database service by the ",(0,s.jsx)(r.code,{children:"_proc"})," resource."]}),"\n",(0,s.jsx)(r.p,{children:"As with most database features, there are a lot of common things about stored procedures across the various database vendors, with some notable exceptions. DreamFactory's blended API defines the difference between stored procedures and how they are used in the API as follows."}),"\n",(0,s.jsx)(r.p,{children:"Procedures can use input parameters ('IN') and output parameters ('OUT'), as well as parameters that serve both as input and output ('INOUT'). They can, except in the Oracle case, also return data directly."}),"\n",(0,s.jsx)(r.admonition,{title:"Database Vendor Exceptions",type:"warning",children:(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"SQLite does not support procedures (or indeed functions)."}),"\n",(0,s.jsx)(r.li,{children:"PostgreSQL calls procedures and functions the same thing (a function) in PostgreSQL. DreamFactory calls them procedures if they have OUT or INOUT parameters or don't have a designated return type, otherwise they are referred to as functions."}),"\n",(0,s.jsx)(r.li,{children:"SQL Server treats OUT parameters like INOUT parameters, and therefore require some value to be passed in."}),"\n"]})}),"\n",(0,s.jsx)(r.h3,{id:"listing-available-stored-procedures",children:"Listing available stored procedures"}),"\n",(0,s.jsx)(r.p,{children:"The following call lists the available stored procedures, based on role access allowed:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"GET http(s)://<dfServer>/api/v2/<serviceName>/_proc\n"})}),"\n",(0,s.jsx)(r.h3,{id:"getting-stored-procedure-details",children:"Getting stored procedure details"}),"\n",(0,s.jsxs)(r.p,{children:["We can use the ",(0,s.jsx)(r.code,{children:"ids"})," url parameter and pass a comma delimited list of resource names to retrieve details about each of the stored procedures. For example if you have a stored procedure named ",(0,s.jsx)(r.code,{children:"getCustomerByLastName"})," a GET call to ",(0,s.jsx)(r.code,{children:"http(s)://<dfServer>/api/v2/<serviceName>?ids=getCustomerByLastName"})," returns the following:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'{\r\n  "resource": [\r\n    {\r\n      "alias": null,\r\n      "name": "getCustomerByLastName",\r\n      "label": "GetCustomerByLastName",\r\n      "description": null,\r\n      "native": [],\r\n      "return_type": null,\r\n      "return_schema": [],\r\n      "params": [\r\n        {\r\n          "name": "LastName",\r\n          "position": 1,\r\n          "param_type": "IN",\r\n          "type": "string",\r\n          "db_type": "nvarchar",\r\n          "length": 25,\r\n          "precision": null,\r\n          "scale": null,\r\n          "default": null\r\n        }\r\n      ],\r\n      "access": 31\r\n    }\r\n  ]\r\n}\r\n\n'})}),"\n",(0,s.jsx)(r.h3,{id:"calling-a-stored-procedure",children:"Calling a stored procedure"}),"\n",(0,s.jsx)(r.h4,{id:"using-get",children:"Using GET"}),"\n",(0,s.jsx)(r.p,{children:"When passing no payload is required, any IN or INOUT parameters can be sent by passing the values in the order required inside parentheses:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/<serviceName>/_proc/myproc(val1, val2, val3)\n"})}),"\n",(0,s.jsx)(r.p,{children:"Or as URL parameters by parameter name:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/<serviceName>/_proc/myproc?param1=val1&param2=val2&param3=val3\n"})}),"\n",(0,s.jsxs)(r.p,{children:["In the below example, there is a stored procedure ",(0,s.jsx)(r.code,{children:"getUsernameByDepartment"})," which takes two input parameters, a department code, and a userID. Making the following call:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"/api/v2/<serviceName>/_proc/getUserNameByDepartment(AB,1234)\n"})}),"\n",(0,s.jsx)(r.p,{children:"In the above example, AB is the department code and 1234 is the userID, which returns:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'{\r\n  "userID": "1234",\r\n  "username": "Tomo"\r\n}\n'})}),"\n",(0,s.jsx)(r.h4,{id:"using-post",children:"Using POST"}),"\n",(0,s.jsx)(r.p,{children:"If a payload is required, i.e. passing values that are not url compliant, or passing schema formatting data, include the parameters directly in order. The same call as above can be made with a POST request with the following in the body:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'{\r\n  "params": ["AB", 1234]\r\n}\n'})}),"\n",(0,s.jsx)(r.h3,{id:"formatting-results",children:"Formatting results"}),"\n",(0,s.jsx)(r.p,{children:"For procedures that do not have INOUT or OUT parameters, the results can be returned as is, or formatted using the returns URL parameter if the value is a single scalar value, or the schema payload attribute for result sets."}),"\n",(0,s.jsx)(r.p,{children:'If INOUT or OUT parameters are involved, any procedure response is wrapped using the configured (a URL parameter wrapper) or default wrapper name (typically "resource"), and then added to the output parameter listing. The output parameter values are formatted based on the procedure configuration data types.'}),"\n",(0,s.jsx)(r.p,{children:'Note that without formatting, all data is returned as strings, unless the driver (i.e. mysqlnd) supports otherwise. If the stored procedure returns multiple data sets, typically via multiple "SELECT" statements, then an array of datasets (i.e. array of records) is returned, otherwise a single array of records is returned.'}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.em,{children:"schema"})," - When a result set of records is returned from the call, the server uses any name-value pairs, consisting of ",(0,s.jsx)(r.code,{children:'"<field_name>": "<desired_type>"'}),", to format the data to the desired type before returning."]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.em,{children:"wrapper"})," - Just like the URL parameter, the wrapper designation can be passed in the posted data."]}),"\n",(0,s.jsx)(r.p,{children:"Request with formatting configuration:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'{\r\n  "schema": {\r\n    "id": "integer",\r\n    "complete": "boolean"\r\n  },\r\n  "wrapper": "data"\r\n}\n'})}),"\n",(0,s.jsx)(r.p,{children:"Response without formatting:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'{\r\n  "resource": [\r\n    {\r\n      "id": "3",\r\n      "name": "Write an app that calls the stored procedure.",\r\n      "complete": 1\r\n    },\r\n    {\r\n      "id": "4",\r\n      "name": "Test the application.",\r\n      "complete": 0\r\n    }\r\n  ],\r\n  "inc": 6,\r\n  "count": 2,\r\n  "total": 5\r\n}\n'})}),"\n",(0,s.jsx)(r.p,{children:"Response with formatting applied:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'{\r\n  "data": [\r\n    {\r\n      "id": 3,\r\n      "name": "Write an app that calls the stored procedure.",\r\n      "complete": true\r\n    },\r\n    {\r\n      "id": 4,\r\n      "name": "Test the application.",\r\n      "complete": false\r\n    }\r\n  ],\r\n  "inc": 6,\r\n  "count": 2,\r\n  "total": 5\r\n}\n'})}),"\n",(0,s.jsx)(r.h3,{id:"using-symmetric-keys-to-decrypt-data-in-a-stored-procedure-sql-server",children:"Using symmetric keys to decrypt data in a stored procedure (SQL Server)"}),"\n",(0,s.jsxs)(r.p,{children:["SQL Server has the ability to perform column level encryption using symmetric keys which can be particularly useful for storing sensitive information such as passwords. A good example of how to do so can be found ",(0,s.jsx)(r.a,{href:"https://www.sqlshack.com/an-overview-of-the-column-level-sql-server-encryption/",children:"here"})]}),"\n",(0,s.jsx)(r.p,{children:"Typically, you would then decrypt this column (assuming the user has access to the certificate) with a statement in your sql server workbench such as:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"OPEN SYMMETRIC KEY SymKey\r\nDECRYPTION BY CERTIFICATE <CertificateName>;\r\n\r\nSELECT <encryptedColumn> AS 'Encrypted data',\r\nCONVERT(varchar, DecryptByKey(<encryptedColumn>)) AS 'decryptedColumn'\r\nFROM SalesLT.Address;\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Now, we cannot call our table endpoint (e.g ",(0,s.jsx)(r.code,{children:"/api/v2/<serviceName>/_table/<tableWithEncryptedField>"}),") and add this logic with DreamFactory, however we could put the same logic in a stored procedure, and have DreamFactory call that to return our decrypted result. As long as the SQLServer user has permissions to the certificate used for encryption, they are able to decrypt the field. You could then use ",(0,s.jsx)(r.a,{href:"../using-the-system-apis/#managing-roles",children:"roles"})," to make sure only certain users have access to this stored procedure."]}),"\n",(0,s.jsx)(r.p,{children:"The stored procedure looks something like this:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"CREATE PROCEDURE dbo.<procedureName>\r\nAS\r\nBEGIN\r\n  SET NOCOUNT on;\r\n  OPEN SYMMETRIC KEY SymKey\r\n  DECRYPTION BY CERTIFICATE <CertificateName>;\r\n\r\n  SELECT <oneField>, CONVERT(nvarchar, DecryptByKey(<encryptedField>)) AS 'decrypted'  \r\n  FROM <table>;\r\nEND\r\nreturn;\n"})}),"\n",(0,s.jsxs)(r.p,{children:["It can be called by DreamFactory with ",(0,s.jsx)(r.code,{children:"/_proc/<procedureName>"}),"."]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>o});var s=n(6540);const t={},i=s.createContext(t);function a(e){const r=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);