"use strict";(self.webpackChunkdf_docs=self.webpackChunkdf_docs||[]).push([[911],{6497:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var a=n(4848),s=n(8453);const r={sidebar_position:2},o="Generating a Database-backed API",i={id:"API Creation and Management/generating-a-database-backed-api",title:"Generating a Database-backed API",description:"DreamFactory's capabilities are vast, however its most popular feature is the ability to generate a database-backed REST API. By embracing this automated approach, development teams can shave weeks if not months off the development cycle, and in doing so greatly reduce the likelihood of bugs or security issues due to mishaps such as SQL injection. This approach doesn't come with any trade offs either, because DreamFactory's database-backed APIs are fully-featured REST interfaces. They offer comprehensive CRUD (create, retrieve, update, delete) capabilities, endpoints for executing stored procedures, and even endpoints for managing the schema.",source:"@site/docs/API Creation and Management/generating-a-database-backed-api.md",sourceDirName:"API Creation and Management",slug:"/API Creation and Management/generating-a-database-backed-api",permalink:"/API Creation and Management/generating-a-database-backed-api",draft:!1,unlisted:!1,editUrl:"https://github.com/dreamfactorysoftware/df-docs/tree/main/docs/API Creation and Management/generating-a-database-backed-api.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"intro",previous:{title:"API Creation and Management",permalink:"/API Creation and Management/api-creation-management"},next:{title:"Interacting with the API",permalink:"/API Creation and Management/interacting-with-api"}},d={},c=[{value:"Generating a MySQL-backed API",id:"generating-a-mysql-backed-api",level:2},{value:"Required configuration fields",id:"required-configuration-fields",level:3},{value:"Optional Configuration Fields",id:"optional-configuration-fields",level:3},{value:"A note about API capabilities",id:"a-note-about-api-capabilities",level:3},{value:"How to setup a MySQL API through an SSH tunnel",id:"how-to-setup-a-mysql-api-through-an-ssh-tunnel",level:3},{value:"Interaction using Postman",id:"interaction-using-postman",level:2},{value:"Installation",id:"installation",level:3},{value:"Interacting with your API via the API Docs",id:"interacting-with-your-api-via-the-api-docs",level:2},{value:"Querying table records",id:"querying-table-records",level:3},{value:"Synchronizing records between two databases * Move to Scripting Section *",id:"synchronizing-records-between-two-databases--move-to-scripting-section-",level:3},{value:"Obfuscating a table endpoint * Move to Scripting Section *",id:"obfuscating-a-table-endpoint--move-to-scripting-section-",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Checking your user credentials",id:"checking-your-user-credentials",level:3},{value:"Logging your database queries",id:"logging-your-database-queries",level:3},{value:"Adding a custom log message to your database queries",id:"adding-a-custom-log-message-to-your-database-queries",level:4},{value:"Using extensions with your databases (PostgreSQL)",id:"using-extensions-with-your-databases-postgresql",level:3}];function l(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"generating-a-database-backed-api",children:"Generating a Database-backed API"})}),"\n",(0,a.jsx)(t.p,{children:"DreamFactory's capabilities are vast, however its most popular feature is the ability to generate a database-backed REST API. By embracing this automated approach, development teams can shave weeks if not months off the development cycle, and in doing so greatly reduce the likelihood of bugs or security issues due to mishaps such as SQL injection. This approach doesn't come with any trade offs either, because DreamFactory's database-backed APIs are fully-featured REST interfaces. They offer comprehensive CRUD (create, retrieve, update, delete) capabilities, endpoints for executing stored procedures, and even endpoints for managing the schema."}),"\n",(0,a.jsx)(t.p,{children:"This topic details DreamFactory's ability to generate, secure, and deploy a database-backed API in just minutes. We've included infomation to help you successfully complete the following tasks:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Generate a new database-backed REST API"}),"\n",(0,a.jsx)(t.li,{children:"Secure API access to your API using API keys and roles"}),"\n",(0,a.jsx)(t.li,{children:"Interact with the auto-generated Swagger documentation"}),"\n",(0,a.jsx)(t.li,{children:"Query the API using a third-party HTTP client"}),"\n",(0,a.jsx)(t.li,{children:"Synchronize records between two databases"}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"We chose MySQL as the basis for examples throughout, because it is free, ubiquitously available on hosting providers and cloud environments, and can otherwise be easily installed on all operating systems. To follow along, ensure you have the following:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Access to a DreamFactory instance and a MySQL database."}),"\n",(0,a.jsx)(t.li,{children:"If your MySQL database is running somewhere other than your laptop, ensure your firewall is configured to allow traffic between port 3306 and the location where your DreamFactory instance is running."}),"\n",(0,a.jsx)(t.li,{children:"A MySQL user account configured so that it can connect to your MySQL server from the DreamFactory instance's IP address."}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"Before we begin, keep in mind that MySQL is just one of 18 databases supported by DreamFactory. The following table presents a complete list of what we support:"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Databases"}),(0,a.jsx)(t.th,{children:"SQL and No SQL"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"AWS DynamoDB"}),(0,a.jsx)(t.td,{children:"IBM Informix"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"AWS Redshift"}),(0,a.jsx)(t.td,{children:"MongoDB"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Azure DocumentDB"}),(0,a.jsx)(t.td,{children:"MySQL"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Azure Table Storage"}),(0,a.jsx)(t.td,{children:"Oracle"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Cassandra"}),(0,a.jsx)(t.td,{children:"PostgreSQL"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Couchbase"}),(0,a.jsx)(t.td,{children:"Salesforce"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"CouchDB"}),(0,a.jsx)(t.td,{children:"SAP SQL Anywhere"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Firebird"}),(0,a.jsx)(t.td,{children:"SQLite"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"IBM Db2"}),(0,a.jsx)(t.td,{children:"SQL Server"})]})]})]}),"\n",(0,a.jsx)(t.p,{children:"Best of all, thanks to DreamFactory's unified interface and API generation solution, everything you learn in this topic applies identically to your chosen database! If you plan on using another database, then by all means follow along using it instead!"}),"\n",(0,a.jsx)(t.admonition,{type:"tip",children:(0,a.jsxs)(t.p,{children:["Looking for a more concise overview of the database API generation process? Check out our blog post, ",(0,a.jsx)(t.a,{href:"https://blog.dreamfactory.com/create-a-mysql-rest-api-in-minutes-using-dreamfactory/",children:'"Create a MySQL REST API in Minutes Using DreamFactory"'}),"!"]})}),"\n",(0,a.jsx)(t.admonition,{type:"tip",children:(0,a.jsxs)(t.p,{children:["Want to create a MySQL API but don't have any test data? You can download a sample database from the MySQL website containing several million records of contrived employee-related data. ",(0,a.jsx)(t.a,{href:"https://dev.mysql.com/doc/employee/en/",children:"Click here"})," to learn more and install the example database. If you've started a ",(0,a.jsx)(t.a,{href:"https://genie.dreamfactory.com/",children:"DreamFactory hosted trial"})," then we've created this database for you! Your welcome e-mail includes the necessary credentials."]})}),"\n",(0,a.jsx)(t.h2,{id:"generating-a-mysql-backed-api",children:"Generating a MySQL-backed API"}),"\n",(0,a.jsxs)(t.p,{children:["To generate a MySQL-backed API, log in to your DreamFactory instance using an administrator account and select the ",(0,a.jsx)(t.strong,{children:"API Generation & Connections"})," tab. Set your API Type to ",(0,a.jsx)(t.strong,{children:"Database"}),", and then click the purple plus button to establish a new connection:"]}),"\n",(0,a.jsx)("img",{src:"/img/database-backed-api/database-api-creation.png",width:"800",alt:"Generate a MySQL API with DreamFactory"}),"\n",(0,a.jsxs)(t.p,{children:["Numerous database types such as MS SQL Server, Oracle, Snowflake, and more are available. There's a lot to review in this menu, but for the moment let's stay on track and search for ",(0,a.jsx)(t.code,{children:"MySQL"}),":"]}),"\n",(0,a.jsx)("img",{src:"/img/database-backed-api/database-api-selection.png",width:"800",alt:"Select MySQL Database Service"}),"\n",(0,a.jsx)(t.p,{children:"Select MySQL, and you are then presented with the following form:"}),"\n",(0,a.jsx)("img",{src:"/img/database-backed-api/mysql-details.png",width:"800",alt:"MySQL Service Information Screen"}),"\n",(0,a.jsx)(t.p,{children:"Let's review the available fields:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Name"}),": The name forms part of your API URL, so ensure you use a lowercase string with no spaces or special characters. You also want to choose a name that allows you to easily identify the API's purpose. For instance for your MySQL-backed API you might choose a name such as ",(0,a.jsx)(t.code,{children:"mysql"}),", ",(0,a.jsx)(t.code,{children:"corporate"}),", or ",(0,a.jsx)(t.code,{children:"store"}),". Keep in mind lowercasing the name is a requirement."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Label"}),': The label is used for referential purposes within the administration interface and system-related API responses. You can use something more descriptive here, such as "MySQL-backed Corporate Database API".']}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Description"}),": Like the label, the description is used for referential purposes within the administration interface and system-related API responses. We recommend including a brief description of what the API is used for."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Active"}),": This toggle determines if the API is active or not. By default it is set to active, however if you're not yet ready to begin using the API or would like to later temporarily disable it, just return to this screen and toggle the checkbox."]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["After completing these fields, click ",(0,a.jsx)(t.code,{children:"Next"})," at the bottom of the interface and the following form displays. We've only included the top of the form as it is fairly long:"]}),"\n",(0,a.jsx)("img",{src:"/img/database-backed-api/mysql-credentials.png",width:"800",alt:"MySQL Service Configuration Screen"}),"\n",(0,a.jsx)(t.p,{children:"This form might look a bit intimidating at first, however in most cases there are only a few fields you need to complete. Let's cover those first, followed by an overview of the optional fields."}),"\n",(0,a.jsx)(t.h3,{id:"required-configuration-fields",children:"Required configuration fields"}),"\n",(0,a.jsx)(t.p,{children:"There are only five (sometimes six) fields you need to completed in order to generate a database-backed API. These include:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Host"}),": The database server's host address. This may be an IP address or a domain name."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Port Number"}),": The database server's port number. For MySQL this is 3306."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Database"}),": The name of the database you'd like to expose via the API."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Username"}),": The username associated with the database user account used to connect to the database."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Password"}),": The password associated with the database user account used to connect to the database."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Schema"}),": If your database supports the concept of a schema, you may specify it here. MySQL doesn't support the concept of a schema, but many other databases do."]}),"\n"]}),"\n",(0,a.jsx)(t.admonition,{type:"warning",children:(0,a.jsx)(t.p,{children:"Keep in mind you are generating an API which can in fact interact with the underlying database! While perhaps obvious, once you generate this API it means any data or schema manipulation requests you subsequently issue will affect your database. Therefore be sure to connect to a test database when first experimenting with DreamFactory so you don't issue requests that you later come to regret."})}),"\n",(0,a.jsx)(t.h3,{id:"optional-configuration-fields",children:"Optional Configuration Fields"}),"\n",(0,a.jsx)(t.p,{children:"Following the required fields there are a number of optional parameters. These can and do vary slightly according to the type of database you've selected, so don't be surprised if you see some variation below. Don't worry about this too much at the moment, because chances are you're not going to need to modify any of the optional configuration fields at this time. However we'd like to identify a few fields which are used more often than others:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Maximum Records"}),": You can use this field to place an upper limit on the number of records returned."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Data Retrieval Caching Enabled"}),": Enabling caching dramatically improves performance. This field is used in conjunction with ",(0,a.jsx)(t.code,{children:"Cache Time to Live"}),", introduced next."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Cache Time to Live (minutes)"}),": If data caching is enabled, you can use this field to specify the cache lifetime in minutes."]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["After completing the required fields in addition to any desired optional fields, click ",(0,a.jsx)(t.code,{children:"Save"})," to generate your API. After a moment a pop up message displays indicating ",(0,a.jsx)(t.code,{children:"Service Saved Successfully"})," and you are redirected to your API Documentation. Congratulations you've just generated your first database-backed API! So what can you do with this cool new toy? Read on to learn more."]}),"\n",(0,a.jsx)(t.h3,{id:"a-note-about-api-capabilities",children:"A note about API capabilities"}),"\n",(0,a.jsxs)(t.p,{children:["Most databases employ a user authorization system which gives administrators the ability to determine exactly what a user can do after successfully establishing a connection. In the case of MySQL, ",(0,a.jsx)(t.em,{children:"privileges"})," are used for this purpose. Administrators can grant and revoke user privileges, and in doing so determine what databases a user can connect to, whether the user can create, retrieve, update, and delete records, and whether the user has the ability to manage the schema."]}),"\n",(0,a.jsx)(t.p,{children:"Because DreamFactory connects to your database on behalf of this user, the resulting API is logically constrained by that user's authorized capabilities. DreamFactory does however display a complete set of Swagger documentation regardless, so if you are attempting to interact with the API via the Swagger docs or using any other client and aren't obtaining the desired outcome, check your database user permissions to confirm the user is authorized to carry out the desired task."}),"\n",(0,a.jsx)(t.p,{children:"Also keep in mind this can serve as an excellent way to further lock down your API. Although DreamFactory offers excellent security-related features for restricting API access, it certainly doesn't hurt to additionally configure the connecting database user's privileges to reflect the desired API capabilities. For instance, if you intend for the API to be read-only, then create a database user with read-only authorization. If API read and create capabilities are desired, then configure the user accordingly."}),"\n",(0,a.jsx)(t.h3,{id:"how-to-setup-a-mysql-api-through-an-ssh-tunnel",children:"How to setup a MySQL API through an SSH tunnel"}),"\n",(0,a.jsx)(t.p,{children:"If you prefer DreamFactory to connect to your MySQL database through an SSH tunnel, then this is a relatively easy process, and can be done by starting an SSH tunnel from within your DreamFactory server. First add your database server's key to where your DreamFactory instance is located. Then open up a terminal window and enter the following command, replacing where necessary:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"ssh -N -L <anOpenHostPort>:127.0.0.1:<mySqlPortOfDBServer> computerUser@<ip> -i <pathToKey>\n"})}),"\n",(0,a.jsx)(t.p,{children:'For example, if I want to use port 3307 on my DreamFactory server to connect to the default database port of my MySQL server (3306), and "admin" is the remote SSH user who has the necessary privileges, the command looks like this:'}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"ssh -N -L 3307:127.0.0.1:3306 admin@10.0.0.10 -i ./server_key\n"})}),"\n",(0,a.jsx)(t.p,{children:"Once the connection has been established, in the DreamFactory interface, you can create your service in the same manner as described above. Instead of pointing to the MySQL server, you point it to the SSH tunnel (localhost)."}),"\n",(0,a.jsx)("img",{src:"/img/database-backed-api/mysql-ssh-tunnel.png",width:"800",alt:"Setup a MySQL API Through an SSH Tunnel"}),"\n",(0,a.jsx)(t.p,{children:"And that's it! You now have the same capabilties as you would with a standard MySQL-backed API, just connected through SSH."}),"\n",(0,a.jsx)(t.admonition,{title:"Reminder",type:"warning",children:(0,a.jsxs)(t.p,{children:["Remember that your ",(0,a.jsx)(t.em,{children:"SSH user"})," (which is used when creating your tunnel from the command line) is most likely different to your ",(0,a.jsx)(t.em,{children:"MySQL user"})," (which is added in DreamFactory when creating your service)."]})}),"\n",(0,a.jsx)(t.h2,{id:"interaction-using-postman",children:"Interaction using Postman"}),"\n",(0,a.jsx)(t.h3,{id:"installation",children:"Installation"}),"\n",(0,a.jsxs)(t.p,{children:["Postman is a utility that allows you to quickly test and use REST APIs. To use the latest published version, click ",(0,a.jsx)(t.strong,{children:"Run in Postman"})," below to import the DreamFactory MYSQL API as a collection:"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://app.getpostman.com/run-collection/a01fb99056769a35df72",children:(0,a.jsx)(t.img,{src:"https://run.pstmn.io/button.svg",alt:"Run in Postman"})})}),"\n",(0,a.jsxs)(t.p,{children:["You can also download the collection file from ",(0,a.jsx)(t.a,{href:"https://github.com/dreamfactorysoftware/dreamfactory-postman-collection",children:"this repo"}),", then import directly into Postman."]}),"\n",(0,a.jsx)(t.h2,{id:"interacting-with-your-api-via-the-api-docs",children:"Interacting with your API via the API Docs"}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"Service Saved Successfully"})," message which appears following successful generation of a new REST API is rather anticlimactic. This simple message really doesn't convey exactly how much tedious work DreamFactory has just saved you and your team. Not only did it generate a fully-featured REST API, but it also secured it from unauthorized access and additionally generated interactive ",(0,a.jsx)(t.a,{href:"https://swagger.io/",children:"OpenAPI documentation"})," for all of your endpoints! If you haven't used Swagger before, you're in for a treat because it's a really amazing tool which allows developers to get familiar with an API without having to write any code. Additionally, each endpoint is documented with details about both the input parameters and response."]}),"\n",(0,a.jsxs)(t.p,{children:["If you were not automatically redirected to this page, select the ",(0,a.jsx)(t.code,{children:"API Docs"})," tab located on the navbar under ",(0,a.jsx)(t.code,{children:"API Generation & Connections"}),":"]}),"\n",(0,a.jsx)("img",{src:"/img/database-backed-api/api-docs-navbar.png",width:"300",alt:"Interacting with your DreamFactory API with the Docs Tab"}),"\n",(0,a.jsxs)(t.p,{children:["You are presented with a list of all documentation associated with your DreamFactory instance. The ",(0,a.jsx)(t.code,{children:"db"}),", ",(0,a.jsx)(t.code,{children:"email"}),", ",(0,a.jsx)(t.code,{children:"files"}),", ",(0,a.jsx)(t.code,{children:"logs"}),", ",(0,a.jsx)(t.code,{children:"system"}),", and ",(0,a.jsx)(t.code,{children:"user"})," documentation are automatically included with all DreamFactory instances, and can be very useful should you eventually desire to programmatically manage your instance. Let's just ignore those for now and focus on the newly generated database documentation. The following screen displays:"]}),"\n",(0,a.jsx)("img",{src:"/img/database-backed-api/apidocs-mysql.png",width:"800",alt:"DreamFactory API Docs Tab"}),"\n",(0,a.jsxs)(t.p,{children:["Scrolling through this list, you can see that quite a few API endpoints have been generated! If you generated an API for a database which supports stored procedures, towards the top endpoints named ",(0,a.jsx)(t.code,{children:"GET /_proc/{procedure_name}"})," and ",(0,a.jsx)(t.code,{children:"POST /_proc/{procedure_name}"})," are listed. Scrolling down, quite a few endpoints used to manage your schema are visible, followed by a set of CRUD (create, retrieve, update, delete) endpoints which are undoubtedly the most commonly used of the bunch."]}),"\n",(0,a.jsx)(t.h3,{id:"querying-table-records",children:"Querying table records"}),"\n",(0,a.jsxs)(t.p,{children:["Let's test the API by retrieving a set of table records. Select the ",(0,a.jsx)(t.code,{children:"GET /_table/{table_name} Retrieve one or more records"})," entry:"]}),"\n",(0,a.jsx)("img",{src:"/img/database-backed-api/apidocs-mysql-getrecords.png",width:"800",alt:"Querying Table Records"}),"\n",(0,a.jsxs)(t.p,{children:["A slideout window opens containing two sections. The first, ",(0,a.jsx)(t.code,{children:"Parameters"}),", identifies the supported request parameters. The second, ",(0,a.jsx)(t.code,{children:"Responses"}),", indicates what you can expect to receive by way of a response, including the status code and a JSON response template. In the case of the ",(0,a.jsx)(t.code,{children:"GET _/table/{table_name}"})," endpoint, you have quite a few parameters at your disposal, because this endpoint represents the primary way in which table data is queried. By manipulating these parameters you can query for all records, or a specific record according to its primary key, or a subset of records according to a particular condition. You can also use these parameters to perform other commonplace tasks such as grouping and counting records, and joining tables."]}),"\n",(0,a.jsxs)(t.p,{children:["To test the endpoint, on the right side of the page, click ",(0,a.jsx)(t.code,{children:"Try it out"}),". When you do, the input parameter fields are enabled, allowing you to enter values to modify the default query's behavior. For the moment we're going to modify just one parameter: ",(0,a.jsx)(t.code,{children:"table_name"}),". It's located at the very bottom of the parameter list. Enter the name of a table you know exists in the database, and press the blue ",(0,a.jsx)(t.code,{children:"Execute"}),' button. Below the button is a "Loading" icon, and soon thereafter a list of records found in the designated table are presented in JSON format. Here\'s an example of what you see when running this endpoint against your test MySQL database:']}),"\n",(0,a.jsx)("img",{src:"/img/database-backed-api/apidocs-mysql-getrecords-output.png",width:"800",alt:"JSON response of API call to MySQL Database"}),"\n",(0,a.jsx)(t.p,{children:"Congratulations! You've just successfully interacted with the database API using the Swagger documentation. If you don't see a list of records, confirm the following:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"Does the specified table exist?"}),"\n",(0,a.jsxs)(t.li,{children:["If you received a ",(0,a.jsx)(t.code,{children:"500"})," status code, check the service configuration credentials. The ",(0,a.jsx)(t.code,{children:"500"})," code almost certainly means DreamFactory was unable to connect to the database. If everything checks out, make sure you can connect to the database from the DreamFactory instance's IP address via the database port. If you can't then it's probably a firewall issue."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"The API Docs interface is fantastically useful for getting familiar with an API, and we encourage you to continue experimenting with the different endpoints to learn more about how it works. However, you'll eventually want to transition from interacting with your APIs via the API Docs interface to doing so using a third-party client, and ultimately by way of your own custom applications. So let's take that next step now, and interact with the new API using an HTTP client. In the last section you were introduced to a few such clients. We'll be using Insomnia for the following examples however there is no material differences between Insomnia, Postman, or any other similar client."}),"\n",(0,a.jsxs)(t.p,{children:["First we need to create an API key to be used to exclusively for accessing this database API. This is done by first creating ",(0,a.jsx)(t.em,{children:"Role Based Access"})," and then assigning the Role to an ",(0,a.jsx)(t.em,{children:"API Key"}),". Let's take care of this in the next section."]}),"\n",(0,a.jsx)(t.h3,{id:"synchronizing-records-between-two-databases--move-to-scripting-section-",children:"Synchronizing records between two databases * Move to Scripting Section *"}),"\n",(0,a.jsxs)(t.p,{children:["You can easily synchronize records between two databases by adding a pre_process event script to the database API endpoint for which the originating data is found. To do so, navigate to the ",(0,a.jsx)(t.strong,{children:"Scripts"})," tab, select the desired database API, and then drill down to the desired endpoint. For instance, if we wanted to retrieve a record from a table named employees found within database API named mysql and send it to another database API (MySQL, SQL Server, etc.) named contacts and possessing a table named names, we would drill down to the following endpoint within the Scripts interface:"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"mysql > mysql._table.{table_name} > mysql._table.{table_name}.get.post_process  mysql._table.employees.get.post_process"})}),"\n",(0,a.jsxs)(t.p,{children:["Once there, you can choose the desired scripting language. We've chosen PHP for this example, but you can learn more about other available scripting engines ",(0,a.jsx)(t.a,{href:"https://wiki.dreamfactory.com/DreamFactory/Features/Scripting",children:"within our wiki documentation"}),". Enable the ",(0,a.jsx)(t.code,{children:"Active"})," checkbox, and add the following script to the glorified code editor:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"    // Assign the $platform['api'] array value to a convenient variable\r\n    $api = $platform['api'];\r\n\r\n    // Declare a few arrays for later use\r\n    $options = [];\r\n    $record = [];\r\n\r\n    // Retrieve the response body. This contains the returned records.\r\n    $responseBody = $event['response']['content'];\r\n\r\n    // Peel off just the first (and possibly only) record\r\n    $employee = $responseBody[\"resource\"][0];\r\n\r\n    // Peel the employee record's first_name and last_name values,\r\n    // and assign them to two array keys named first and last, respectively.\r\n    $record[\"resource\"] = [\r\n        [\r\n            'first' => $employee[\"first_name\"],\r\n            'last' => $employee[\"last_name\"],\r\n        ]\r\n    ];\r\n\r\n    // Identify the location to which $record will be POSTed\r\n    // and execute an API POST call.\r\n    $url = \"contacts/_table/names\";\r\n    $post = $api->post;\r\n    $result = $post($url, $record, $options);\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Save the changes, making sure the script's ",(0,a.jsx)(t.code,{children:"Active"})," checkbox is enabled. Then make a call to the ",(0,a.jsx)(t.code,{children:"employees"})," table which results in the return of a single record, such as:"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.code,{children:"/api/v2/mysql/_table/employees?filter=emp_no=10001"})}),"\n",(0,a.jsx)(t.p,{children:"Of course, there's nothing stopping you from modifying the script logic to iterate over an array of returned records."}),"\n",(0,a.jsx)(t.h2,{id:"obfuscating-a-table-endpoint--move-to-scripting-section-",children:"Obfuscating a table endpoint * Move to Scripting Section *"}),"\n",(0,a.jsxs)(t.p,{children:["Sometimes you might want to completely obfuscate the DreamFactory-generated database API endpoints, and give users a URI such as ",(0,a.jsx)(t.code,{children:"/api/v2/employees"})," rather than ",(0,a.jsx)(t.code,{children:"/api/v2/mysql/_table/employees"}),". At the same time you don't want to limit the ability to perform all of the usual CRUD tasks. Fortunately this is easily accomplished using a scripted service. The following example presents the code for a scripted PHP service that has been assigned the namespace ",(0,a.jsx)(t.code,{children:"employees"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"    $api = $platform['api'];\r\n    $get = $api->get;\r\n    $post = $api->post;\r\n    $put = $api->put;\r\n    $patch = $api->patch;\r\n    $delete = $api->delete;\r\n\r\n    $api_path = 'mysql/_table/employees';\r\n\r\n    $method = $event['request']['method'];\r\n\r\n    $options = [];\r\n\r\n    $params = $event['request']['parameters'];\r\n\r\n    $result = '';\r\n\r\n    $resource = $event['response']['content']['resource'];\r\n\r\n    if ($resource && $resource !== '') {\r\n      $api_path = $api_path + '/' . $resource;\r\n    }\r\n\r\n    if ($event['request']['payload']) {\r\n      $payload = $event['request']['payload'];\r\n    } else {\r\n      $payload = null;\r\n    }\r\n\r\n    switch ($method) {\r\n      case 'GET':\r\n          $result = $get($api_path, null, $options);\r\n          break;\r\n      case 'POST':\r\n          $result = $post($api_path, $payload, $options);\r\n          break;\r\n      case 'PUT':\r\n          $result = $put($api_path, $payload, $options);\r\n          break;\r\n      case 'PATCH':\r\n          $result = $patch($api_path, $payload, $options);\r\n          break;\r\n      case 'DELETE':\r\n          $result = $delete($api_path, $payload, $options);\r\n          break;\r\n      default:\r\n          $result = \"error\";\r\n          break;\r\n    }\r\n\r\n    return $result;\n"})}),"\n",(0,a.jsxs)(t.p,{children:["With this script in place, you can use the following endpoint to interact with the MySQL API's ",(0,a.jsx)(t.code,{children:"employees"})," table:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"https://dreamfactory.example.com/api/v2/employees\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Issuing a ",(0,a.jsx)(t.code,{children:"GET"})," request to this endpoint returns all of the records. Issuing a ",(0,a.jsx)(t.code,{children:"POST"})," request to this endpoint with a body such as the following inserts a new record:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'    {\r\n        "resource": [\r\n        {\r\n          "emp_no": 500037,\r\n          "birth_date": "1900-12-12",\r\n          "first_name": "Joe",\r\n          "last_name": "Texas",\r\n          "gender": "m",\r\n          "hire_date": "2007-01-01"\r\n        }\r\n        ]\r\n    }\n'})}),"\n",(0,a.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsxs)(t.p,{children:["If you'd like to see what queries are being executed by your MySQL database, you can enable query logging. Begin by creating a file named ",(0,a.jsx)(t.code,{children:"query.log"})," in your Linux environment's ",(0,a.jsx)(t.code,{children:"/var/log/mysql"})," directory:"]}),"\n",(0,a.jsx)(t.p,{children:"$ cd /var/log/mysql\r\n$ sudo touch query.log"}),"\n",(0,a.jsxs)(t.p,{children:["Next, make sure the MySQL daemon can write to the log. You might have to adjust the user and group found in the below ",(0,a.jsx)(t.code,{children:"chmod"})," command to suit your particular environment:"]}),"\n",(0,a.jsx)(t.p,{children:"$ sudo chown mysql.mysql /var/log/mysql/query.log\r\n$ sudo chmod u+w /var/log/mysql/query.log"}),"\n",(0,a.jsx)(t.p,{children:"Finally, turn on query logging by running the following two commands:"}),"\n",(0,a.jsx)(t.p,{children:"mysql> SET GLOBAL general_log_file = '/var/log/mysql/query.log';\r\nQuery OK, 0 rows affected (0.00 sec)"}),"\n",(0,a.jsx)(t.p,{children:"mysql> SET GLOBAL general_log = 'ON';\r\nQuery OK, 0 rows affected (0.00 sec)"}),"\n",(0,a.jsxs)(t.p,{children:["To view your executed queries in real-time, ",(0,a.jsx)(t.code,{children:"tail"})," the query log:"]}),"\n",(0,a.jsxs)(t.p,{children:["$ tail -f /var/log/mysql/query.log\r\n/usr/sbin/mysqld, Version: 5.7.19-0ubuntu0.16.04.1 ((Ubuntu)). started with:\r\nTcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock\r\nTime                 Id Command    Argument\r\n2019-03-28T14:50:19.758466Z\t   76 Quit\r\n2019-03-28T14:50:31.648530Z\t   77 Connect\t",(0,a.jsx)(t.a,{href:"mailto:homestead@dreamfactory.test",children:"homestead@dreamfactory.test"})," on employees using TCP/IP\r\n2019-03-28T14:50:31.648635Z\t   77 Query\tuse ",(0,a.jsx)(t.code,{children:"employees"}),"\r\n2019-03-28T14:50:31.648865Z\t   77 Prepare\tset names 'utf8' collate 'utf8_unicode_ci'\r\n2019-03-28T14:50:31.648923Z\t   77 Execute\tset names 'utf8' collate 'utf8_unicode_ci'\r\n2019-03-28T14:50:31.649029Z\t   77 Close stmt\r\n2019-03-28T14:50:31.649305Z\t   77 Prepare\tselect ",(0,a.jsx)(t.code,{children:"first_name"}),", ",(0,a.jsx)(t.code,{children:"hire_date"})," from ",(0,a.jsx)(t.code,{children:"employees"}),".",(0,a.jsx)(t.code,{children:"employees"})," limit 5 offset 0\r\n2019-03-28T14:50:31.649551Z\t   77 Execute\tselect ",(0,a.jsx)(t.code,{children:"first_name"}),", ",(0,a.jsx)(t.code,{children:"hire_date"})," from ",(0,a.jsx)(t.code,{children:"employees"}),".",(0,a.jsx)(t.code,{children:"employees"})," limit 5 offset 0\r\n2019-03-28T14:50:31.649753Z\t   77 Close stmt\r\n2019-03-28T14:50:31.696379Z\t   77 Quit"]}),"\n",(0,a.jsx)(t.h3,{id:"checking-your-user-credentials",children:"Checking your user credentials"}),"\n",(0,a.jsxs)(t.p,{children:["Many database API generation issues arise due to a misconfigured set of user credentials. These credentials must possess privileges capable of connecting from the IP address where DreamFactory resides. To confirm your user can connect from the DreamFactory server, create a file named mysql-test.php and add the following contents to it. Replace the ",(0,a.jsx)(t.code,{children:"HOSTNAME"}),", ",(0,a.jsx)(t.code,{children:"DBNAME"}),", ",(0,a.jsx)(t.code,{children:"USERNAME"}),", and ",(0,a.jsx)(t.code,{children:"PASSWORD"})," placeholders with your credentials:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'    <?php\r\n\r\n    $dsn = "mysql:host=HOSTNAME;dbname=DBNAME";\r\n    $user = "USERNAME";\r\n    $passwd = "PASSWORD";\r\n\r\n    $pdo = new PDO($dsn, $user, $passwd);\r\n\r\n    $stmt = $pdo->query("SELECT VERSION()");\r\n\r\n    $version = $stmt->fetch();\r\n\r\n    echo $version[0] . PHP_EOL;\n'})}),"\n",(0,a.jsx)(t.p,{children:"Save the changes and run the script like so:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"    $ php mysql-test.php\r\n    5.7.29-0ubuntu0.16.04.1\n"})}),"\n",(0,a.jsx)(t.p,{children:"If the MySQL version number isn't returned, then the user is unable to connect remotely."}),"\n",(0,a.jsx)(t.h3,{id:"logging-your-database-queries",children:"Logging your database queries"}),"\n",(0,a.jsxs)(t.p,{children:["If you want to see the database queries being generated by DreamFactory, open the ",(0,a.jsx)(t.code,{children:".env"})," file, and in 'Database Settings' the following details are visible:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"#DB_QUERY_LOG_ENABLED=false\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Uncomment and set the ",(0,a.jsx)(t.code,{children:"DB_QUERY_LOG_ENABLED"})," value to ",(0,a.jsx)(t.code,{children:"true"}),", and also set ",(0,a.jsx)(t.code,{children:"APP_LOG_LEVEL=debug"}),". Whenever you make a database query, the statement is sent to the log file (found in ",(0,a.jsx)(t.code,{children:"storage/logs/dreamfactory.log"}),"). A typical output to the log looks like this:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"[2021-05-28T05:47:10.965487+00:00] local.DEBUG: API event handled: mysqldb._table.{table_name}.get.pre_process  \r\n[2021-05-28T05:47:10.966765+00:00] local.DEBUG: API event handled: mysqldb._table.employees.get.pre_process  \r\n[2021-05-28T05:47:12.388272+00:00] local.DEBUG: service.mysqldb: select `emp_no`, `birth_date`, `first_name`, `last_name`, `gender`, `hire_date` from `xenonpartners`.`employees` limit 2 offset 0: 1385.25  \r\n[2021-05-28T05:47:12.392063+00:00] local.DEBUG: API event handled: mysqldb._table.{table_name}.get.post_process  \r\n[2021-05-28T05:47:12.393794+00:00] local.DEBUG: API event handled: mysqldb._table.employees.get.post_process \n"})}),"\n",(0,a.jsx)(t.h4,{id:"adding-a-custom-log-message-to-your-database-queries",children:"Adding a custom log message to your database queries"}),"\n",(0,a.jsxs)(t.p,{children:["When using a scripted service, and with ",(0,a.jsx)(t.code,{children:"DB_QUERY_LOG_ENABLED"})," set to ",(0,a.jsx)(t.code,{children:"true"}),", it is possible to add a custom log message using the following syntax:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"use Log;\r\n\r\n...\r\n\r\nif (config('df.db.query_log_enabled')) {\r\n    \\Log::debug(<your message>);\r\n}\r\n\r\n...\n"})}),"\n",(0,a.jsxs)(t.p,{children:["See ",(0,a.jsx)(t.a,{href:"../limiting-and-logging-api-requests/",children:"this section"})," for more information about logging."]}),"\n",(0,a.jsx)(t.h3,{id:"using-extensions-with-your-databases-postgresql",children:"Using extensions with your databases (PostgreSQL)"}),"\n",(0,a.jsx)(t.p,{children:"PostgreSQL has a number of extensions to enhance database capabilities. One of the most popular is PostGIS and its topology functionality for representing vector data."}),"\n",(0,a.jsx)(t.p,{children:"If your PostgreSQL database uses this (or any other) extension, when using DreamFactory to make an API call (especially a function or procedure), you may see this error, or something similar to it:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-json",children:'"error": {\r\n    "code": 500,\r\n    "context": null,\r\n    "message": "Failed to call database stored function.\\nSQLSTATE[42883]: Undefined function: 7 ERROR:  function st_setsrid(public.geometry, integer) does not exist\r\n    ... \r\n}\n'})}),"\n",(0,a.jsx)(t.p,{children:"This is most likely occuring because the extension's functions are located in a different schema to the schema used by the database, and the postgreSQL user that DreamFactory has been assigned, as a result, cannot see it."}),"\n",(0,a.jsxs)(t.p,{children:["In order for DreamFactory to be able to see the extension's functions, you should add this line to the ",(0,a.jsx)(t.code,{children:"Additional SQL Statements"})," setting (change to match the extensions and schemas you are using) which you can find in your postgres service's ",(0,a.jsx)(t.strong,{children:"Configuration"})," tab's ",(0,a.jsx)(t.strong,{children:"Optional Advanced Settings"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'SET search_path TO "$user", public, postgis, topology;\n'})}),"\n",(0,a.jsx)("img",{src:"/img/database-backed-api/postgis_search_path.png",width:"800",alt:"Adding a search path to your postgres connection"}),"\n",(0,a.jsx)(t.p,{children:"This allows DreamFactory to search through additional schemas to find the functions that the database requires when using any extensions."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>i});var a=n(6540);const s={},r=a.createContext(s);function o(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);